**重要檔案**

****


**--雲林縣 API 即時淹水預警系統--**


本系統是一套針對雲林縣設計的自動化即時淹水預報工具。透過整合即時雨量 API、深度學習模型預測與 GIS 空間內插技術，系統能實現每小時自動化的預警產出，提供精確至村里層級的淹水風險評估。

**系統核心能力與技術亮點:**

本系統(exe執行檔)運作邏輯設計為：每小時自動抓取最新雨量資料，執行一輪完整流程（每小時的資料抓取 $\rightarrow$ 預測 $\rightarrow$ 空間內插(反距離權重法) $\rightarrow$ 輸出風險評估數值），全程全自動化無需人工干預。

**功能簡述:**

針對雲林全縣 17 個關鍵測站，基於以歷史降雨及模擬淹水資料為數據進行訓練之機器學習模型，預測 17 個測站各自未來 1 至 4 小時的即時淹水深度。運算完成後，透過 IDW (反距離權重法)，將點狀測站數據轉化為各村里的淹水深度，並依照設計邏輯自動判定風險等級。此風險等級資料已完成與科技公司之合作，每隔一個小時都會即時部署並更新於雲林縣政府提供之氣象資料之中。

**做法與參數介紹**

作物暴露度與綜合風險評估：系統將以1~5級自動量化「淹水嚴重度 (Hazard)」與「作物暴露度 (Exposure)」，計算出最終的「綜合風險等級 (Risk)」。同時我也設計了內建自動初始化與備份程式，確保在多日連續運作或新降雨事件開始時系統資料的完整性與資料乾淨度。


**--系統架構與模組說明--**


### 1️⃣ 資料前處理模組
本模組負責資料的標準化與清洗，確保模型訓練資料的物理合理性。
* **11_debug_cwa_api_structure.py**: 自動化解析中央氣象署 API 結構，確保觀測資料擷取穩定性。
* **13_standardize_historical_rain_depth_data.py**: 統一不同時間、來源的雨量與水深欄位，建立 17 個測站的一致性特徵。
* **14_adjust_depth_no_flood.py**: 針對未淹水事件標記為 `-1`。

### 2️⃣ 即時資料管線
* **realtime_rain_fetcher.py**: 持續維持固定長度的時間序列，每小時自動產出 11 個關鍵站點的最新雨量特徵矩陣。
* **api_to_py.py**: 封裝 API 抓取流程，自動適應 Python 與 `.exe` 打包環境，確保部署無縫銜接。

### 3️⃣ 模型訓練與自回歸推論
本系統之核心預測邏輯，採用 **XGBoost 自回歸機制**。
* **TRAIN_FINAL_MODELS.py**: 針對雲林縣或鄰近雲林縣之 17 個淹水點，分別訓練 T+1 至 T+4 預報，產出共 68 組最終部署模型權重。
* **predict_ip_depth.py**: 載入權重後，以 `PrevDepth` (前一時刻預測深度) 作為特徵進行滾動式預測（自回歸），以增加預測準確率。

### 4️⃣ 空間聚合與風險輸出
* **depth_to_village.py**: 利用「反距離權重法」，將離散的淹水點預測值，轉換為雲林縣各村里尺度的平均淹水深度。
* **風險等級轉譯**: 依據預測深度，將連續數值轉換為 **Level 1–5 風險等級**。
* **merge_village_levels_to_final.py**: 採用 Key-Value 對接方式更新成果檔，確保不破壞既有 Excel 公式與格式。

### 5️⃣ 系統自動化與維運
* **主控程式 (`run_all.py`)**: 整合所有子模組，透過無限迴圈與例外處理機制，達成 **24/7 每小時自動更新預報**。
* **備份與重置 (`AD_realtime_reset_and_backup.py`)**: 具備時間戳記自動備份機制，確保歷史預報紀錄可回溯，並隨時提供系統乾淨啟動。
