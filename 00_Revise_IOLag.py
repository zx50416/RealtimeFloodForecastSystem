# ========================================================================
# ä½¿ç”¨èªªæ˜
# ========================================================================
# åªä¿®æ”¹ IOLag.xlsxï¼Œå°ˆæ³¨åœ¨åŒä¸€ç©ºé–“é»ä½ï¼Œä¸€æ¬¡ä¿®æ”¹ T+1 ~ T+4ã€‚

# ========================================================================
# åƒæ•¸è¨­å®š
# ========================================================================
import os
from openpyxl import Workbook

# çœŸçš„æœ‰çš„ IP ç·¨è™Ÿï¼ˆæ²’æœ‰ IP04ï¼Œæ‰€ä»¥ä¸æ”¾ 4ï¼‰
VALID_IP_LIST = [1, 2, 3, 5, 7, 8, 10, 12, 13, 14, 15, 16, 17, 18, 25, 27, 28]

# ========================================================================
# ä¸»ç¨‹å¼
# ========================================================================
base_path = os.path.join(os.path.dirname(os.path.abspath(__file__)), 'DATA')

for ip in VALID_IP_LIST:
    IPnumber = f"{ip:02d}"   # 1 -> '01'  10 -> '10'
    print(f"æ·¹æ°´é»ä½ {IPnumber}")

    # è³‡æ–™å¤¾åç¨±åˆ—è¡¨ (å„æ·¹æ°´é» T+1~T+4)
    folders = [
        f'IP{IPnumber}-1/',
        f'IP{IPnumber}-2/',
        f'IP{IPnumber}-3/',
        f'IP{IPnumber}-4/',
    ]

    DeltaT = 0

    for folder in folders:
        DeltaT += 1   # è¨ˆç®—æœªä¾†ç¬¬ DeltaT å°æ™‚ï¼Œè¦å¯«å…¥ IOLag ç”¨

        folder_path = os.path.join(base_path, folder)

        # ğŸ‘‰ å¦‚æœè³‡æ–™å¤¾æ ¹æœ¬ä¸å­˜åœ¨ï¼Œå°±è·³éé€™ä¸€å€‹
        if not os.path.isdir(folder_path):
            print(f"  âš ï¸ æ‰¾ä¸åˆ°è³‡æ–™å¤¾ {folder_path}ï¼Œç•¥éã€‚")
            continue

        file_path = os.path.join(folder_path, 'IOLag.xlsx')

        # æ¬²å¯«å…¥çš„ IOLag å…§å®¹
        new_data = [
            ['IO', 'Factor', 'Lag(IOFL2)'],
            [1, 1, 0],
            [1, 2, 0],
            [1, 3, 0],
            [1, 4, 0],
            [1, 5, 0],
            [1, 6, 0],
            [1, 7, 0],
            [1, 8, 0],
            [1, 9, 0],
            [1, 10, 0],
            [1, 11, 0],
      
            # [1, 1, -1],
            # [1, 2, -1],
            # [1, 3, -1],
            # [1, 4, -1],
            # [1, 5, -1],
            # [1, 6, -1],
            # [1, 7, -1],
            # [1, 8, -1],
            # [1, 9, -1],
            # [1, 10, -1],
            # [1, 11, -1],            
            [2, 12, DeltaT],  # é€™è¡Œç…§ä½ åŸæœ¬çš„è¨­è¨ˆ
        ]

        # å¦‚æœèˆŠçš„ IOLag.xlsx å­˜åœ¨ï¼Œå…ˆåˆªæ‰
        if os.path.isfile(file_path):
            os.remove(file_path)

        # å»ºç«‹æ–°çš„ Excel æª”æ¡ˆä¸¦å¯«å…¥è³‡æ–™
        wb = Workbook()
        ws = wb.active
        ws.title = 'IOLag'

        for row_data in new_data:
            ws.append(row_data)

        wb.save(file_path)
        print(f"  âœ… å·²ä¿®æ”¹ {folder} è³‡æ–™å¤¾ä¸­çš„ IOLag.xlsx")
